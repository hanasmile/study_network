# Chapter06.전송 계층

- [전송 계층의 역할](#%EF%B8%8F-전송-계층의-역할)
- [TCP의 구조](#%EF%B8%8F-tcp의-구조)
- [재전송 제어 및 포트번호의 구조](#%EF%B8%8F-재전송-제어-및-포트번호의-구조)
- [UDP의 구조](#%EF%B8%8F-udp의-구조)

 
<br>

## 💡 전송 계층의 역할
> 목적지에 신뢰할 수 잇는 데이터를 전달하기 위해 필요한 계층이 전송 계층이다.


### 추가적인 내용 기술
- 물리계층, 데이터 링크 계층, 네트워크 계층의 3계층이 있으면 목적지에 데이터를 보낼 수 있지만, 데이터가 손실되거나 유실되더라도 이들 계층에서는 책임지지 않는다.
- 전송 계층에서는 오류를 검증할 수 있는 기능이 있어 오류가 발생하면 데이터를 재전송하도록 요청한다. 즉, 목적지에 도달한 데이터가 제대로 도착했는지 확인을 거친다.
- 또 다른 역할은 해당 데이터가 어떤 애플리케이션에게 전달되어야할지 판단하는 역할을 한다. 즉, 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별한다.
- 전송 계층의 특징은 신뢰성/정확성과 효율성으로 구분할 수 있고, 여기서 신뢰할 수 있고 정확한 데이터를 전달하는 통신을 연결형 통신이라하고, 효율적으로 데이터를 전달하는 통신을 비연결형 통신이라 한다.
- 또한 전송계층에서 연결형 통신 프로토콜은 TCP 프로토콜, 비연결형 통신 프로토콜로는 UDP 프로토콜이 사용된다.

<br>

## 💡 TCP의 구조
> TCP는 신뢰성과 정확성을 우선시하는 전송계층의 연결형 통신 프로토콜로, 전송 계층에서 TCP로 통신이 이뤄질 때, TCP 헤더를 붙이는데 이 TCP 헤더가 붙은 데이터를 세그먼트라 한다. 연결형 통신은 꼼꼼하게 상대방을 확인하면서 데이터를 전송하는데, 데이터를 전송하기 위해 사전에 가상의 독점 통신로를 확보해야한다. 이를 3-way 핸드쉐이크라 한다.


### 추가적인 내용 기술
- TCP 헤더는 아래와 같은 다양한 식별 정보를 갖고 있다.
> - 출발지 포트 번호(16비트)
> - 목적지 포트 번호(16비트)
> - 일련번호(32비트)
> - 확인 응답 번호(32비트)
> - 헤더 길이(4비트)
> - 예약 영역(6비트)
> - 코드 비트(6비트) : URG, ACK PSH, RST, SYN, FIN
> - 윈도우 크기(16비트)
> - 체크섬(16비트)
> - 긴급 포인터(16비트)
> - 옵션
- 위의 식별 정보 중 코드 비트(RG, ACK PSH, RST, SYN, FIN)에는 연결의 제어 정보가 기록된다.
- 코드 비트는 각 비트별로 역할이 있는데, 초기값은 0이고 비트가 활성화되면 1로 변한다. 이 때, 가상의 독점 통신로를 확립하려면 SYN(연결요청)과 ACK(확인응답)가 활성화되어야 한다.
- 데이터를 보내기 전 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것을 3-way 핸드쉐이크라 하는데 이는 아래와 같은 3개의 과정을 거친다.
> 1. 클라이언트에서 서버로 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.
>2. 서버는 클라이언트의 요청을 받은 후 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK)과 함께 서버로 클라이언트에게 데이터 전송 허가를 받기 위해 연결 확립 요청(SYN)을 보낸다.
>3. 클라이언트는 서버의 요청을 받은 뒤, 서버를 허가한다는 응답으로 연결 확립 응답(ACK)를 보낸다.

![](https://images.velog.io/images/jewon119/post/c9ac0546-f0dd-4ea8-9555-2273fbe67efd/what-is-a-tcp-3-way-handshake-process-three-way-handshaking-establishing-connection-6a724e77ba96e241.jpeg)
-

<br>

## 💡 재전송 제어 및 포트번호의 구조
> TCP 프로토콜을 사용할 때, TCP 헤더에 일련번호와 확인 응답 번호를 통해 데이터가 손상되거나 유실된 경우 데이터를 재전송 받을 수 있는데, 이를 재전송 제어라 한다. 전송된 데이터의 목적지가 어떤 애플리케이션에 전달되야하는지 제어하는 것은 전송 계층의 역할 중 하나이며, 이는 포트번호를 통해 식별한다.



### 추가적인 내용 기술
- TCP는 데이터를 분할해서 보내는데 일련번호는 수신 측에 '이 데이터가 몇 번째 데이터인지' 알려주는 역할을 한다. 즉, 일련번호는 분할된 데이터의 순서 정보를 담고 있다.
- 확인 응답 번호는 수신측이 몇 번 째 데이터를 수신했는지 송신측에 알려주는 역할과 다음 번호의 데이터를 요청하는 기능을 맡는다.
- TCP 헤더에 출발지 포트 번호와 목적지 포트 번호를 담기 때문에 포트 번호를 통해 웹 브라우저에 전달해야할지, 메신저 프로그램에 전달해야할지 구분할 수 있다.
- 포트 번호는 0~65535번을 사용할 수 있고, 0~1023번 포트는 주요 프로토콜이 사용하도록 예약되어 있다. 이러한 포트를 잘 알려진 포트(well-know posts)라 한다.


<br>

## 💡 UDP의 구조 
> UDP 헤더가 붙은 데이터를 UDP 데이터그램이라하고, UDP 헤더의 식별 정보는 간단한 구조를 띄고 있다. 이는 UDP의 경우 신뢰성/정확성을 보장하지 않는 대신 효율성을 추구하기 때문이다.


### 추가적인 내용 기술
- UDP는 효율성을 중요시하는 프로토콜로 TCP 처럼 신뢰성과 정확성을 요구하지 않기 때문에 헤더가 간결하다.
> - 출발지 포트 번호(16비트)
> - 도착지 포트 번호(16비트)
> - 길이(16비트)
> - 체크섬(16비트)
- 또한 UDP는 랜에 있는 PC나 스위치로 연결된 PC로 일괄적으로 데이터를 보낼 수 있는데 이를 브로드캐스트 통신이라 한다.
- TCP는 3-way 핸드쉐이크를 통해 응답 확인을 일일이 거쳐야하기 때문에 브로드캐스트와 같이 불특정 다수에게 보내는 통신에는 적합하지 않다.